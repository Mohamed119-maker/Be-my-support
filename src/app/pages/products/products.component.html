<h1 class="capitalize text-main-color text-2xl pt-[80px] text-center font-semibold bg-gray-100">
    {{ selectedCat() }}
</h1>

<section class="grid grid-cols-1 md:grid-cols-[25%_minmax(0,1fr)] gap-4 p-5 items-start bg-gray-100">
    <!-- Sidebar -->
    <div>
        <div class="sidebar-wrapper bg-white rounded-lg shadow-sm p-4">
            @if (isLoadingCategories()) {
            <!-- Categories Loading Skeleton -->
            <div class="space-y-4">
                <div class="h-6 bg-gray-200 rounded-md w-24 animate-pulse"></div>
                <div class="space-y-3">
                    @for (item of [1,2,3,4,5,6,7]; track item) {
                    <div class="h-5 bg-gray-100 rounded animate-pulse"></div>
                    }
                </div>
            </div>
            } @else {
            <p-accordion [activeIndex]="0">
                <p-accordionTab header="Category">
                    <ul class="category-list">
                        <li class="px-4 py-2 hover:bg-gray-50 cursor-pointer transition-colors rounded-md"
                            (click)="getAllProducts()">
                            All products
                        </li>
                        @for (cat of categories(); track cat._id) {
                        <li (click)="getAllProducts(cat._id)"
                            class="px-4 py-2 hover:bg-gray-50 cursor-pointer transition-colors rounded-md">
                            {{ cat.name }}
                        </li>
                        }
                    </ul>
                </p-accordionTab>
            </p-accordion>
            }
        </div>
    </div>

    <!-- Products Grid -->
    <div>
        <div class="container mx-auto">
            @if (isLoadingProducts()) {
            <!-- Products Loading Skeleton -->
            <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                @for (item of [1,2,3,4,5,6]; track item) {
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <!-- Image Skeleton -->
                    <div class="h-48 bg-gray-200 animate-pulse"></div>
                    <!-- Content Skeleton -->
                    <div class="p-4 space-y-3">
                        <!-- Title -->
                        <div class="h-6 bg-gray-100 rounded w-3/4 animate-pulse"></div>
                        <!-- Description -->
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-100 rounded animate-pulse"></div>
                            <div class="h-4 bg-gray-100 rounded w-5/6 animate-pulse"></div>
                        </div>
                        <!-- Price and Action -->
                        <div class="flex justify-between items-center pt-3">
                            <div class="h-6 w-24 bg-gray-200 rounded animate-pulse"></div>
                            <div class="h-8 w-8 bg-gray-200 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
                }
            </div>
            } @else if (products().length === 0) {
            <!-- No Products State -->
            <div class="flex flex-col items-center justify-center py-12 text-center">
                <div class="text-6xl text-gray-300 mb-4">
                    <i class="pi pi-shopping-bag"></i>
                </div>
                <h2 class="text-xl font-semibold text-gray-600">No products found</h2>
                <p class="text-gray-500 mt-2">Try selecting a different category or check back later.</p>
            </div>
            } @else {
            <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                @for (prod of products(); track prod._id) {
                @if (isInWishlist(prod._id)) {
                <app-card [imageCover]="prod.imageCover.secure_url" [finalPrice]="prod.finalPrice"
                    [description]="prod.description" [price]="prod.price" [discount]="prod.discount"
                    [createdAt]="prod.createdAt" [title]="prod.title" [address]="prod.createdBy?.address"
                    [productId]="prod._id" [liked]="true" />
                } @else {
                <app-card [imageCover]="prod.imageCover.secure_url" [finalPrice]="prod.finalPrice"
                    [description]="prod.description" [price]="prod.price" [discount]="prod.discount"
                    [createdAt]="prod.createdAt" [title]="prod.title" [address]="prod.createdBy?.address"
                    [productId]="prod._id" [liked]="false" />
                }
                }
            </div>
            }
        </div>
    </div>
</section>

<!-- Pagination -->
@if (!isLoadingProducts() && products().length > 0) {
<div class="flex justify-center mt-4 mb-4">
    <p-paginator (onPageChange)="onPageChange($event)" [first]="first()" [rows]="rows()" [totalRecords]="totalRecords()"
        [pageLinkSize]="5" [showFirstLastIcon]="true" [showPageLinks]="true" [showCurrentPageReport]="true"
        currentPageReportTemplate="{first} - {last} of {totalRecords} products">
    </p-paginator>
</div>
}